
/*
 * GET home page.
 */
exports.index = function(req, res){
  res.render('menu', { title: 'Piece' });
};

/**
* Lit le fichier json !  liste des modules p/ piece
*/
function readContent(callback){
	var fs = require ('fs');
	var myFile = './public/pieces.json';
	console.log('-Verification du fichier');
	if (fs.existsSync(myFile)){
		console.log('-lecture du fichier');
		fs.readFile(myFile, 'utf8',function(err, content){
			if (err) return callback(err)
			callback(null, content)
		})
	}else{console.log('*!!* Erreur de fichier'); }
};

/**
* Affiche les modules d'une pieces
*/
exports.lirepiece = function(req,res){
  readContent( function (err,content) {
	console.log(content);
	 lesModules = JSON.parse(content);
	console.log("xxxx",lesModules[1].piece);
	res.render('modules', { modules: lesModules, type_piece : req.params.id });
})
};

/*exports.lirepiece = function (req,res){
  var fs = require ('fs');
  var filename = '/public/cuisine.json';

  fs.readFile(filename, function (err, data)){
    if (err) {
      console.log('**ERR : '+err);
   }

    data = json.parse(data);
    console.log(data);
   }
};
*/

exports.index2 = function (req,res){
  var personnes = [
	{name:'Shuriken',price:100},
	{name:'Ashiko',price:690},
	{name:'Chigiriki',price:250},
	{name:'Naginata',price:900},
	{name:'Katana',price:1000},
];
  console.log(personnes);
  res.render('modules',{personnes:personnes});
  
};
/*
exports.db = function(req,res){
  var MongoClient = require('mongodb').MongoClient , format = require ('util').format;
  MongoClient.connect('mongodb://127.0.0.1:27017/test' , function (err, db) {
	if (err) {
		throw err;	
	} else {
		console.log("successfully connected to the db");
	}
	db.close();
   res.render('index',{message: "successfully connected to the db"}); 
 };
};
*/

/*
exports.test = function (req,test){
  var sys = require('sys');
  var exec = require ('child_precess').exec;
  function puts(error, stdout, stderr) {sys.puts(stdout};
  exec("ls /home/eric", puts);
  console.log(stdout);
  res.send(stdout);
};
*/


